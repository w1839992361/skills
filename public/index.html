<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="./admin/assets/js/vue.2.6.12.min.js"></script>
    <script src="./admin/assets/js/axios.js"></script>
    <script src="./admin/assets/js/vue-router.js"></script>
<!--    <script src="./assets/js/app.js"></script>-->
</head>
<body>
<div id="app" :class="[$route.path == '/home' ? 'index-page' :'']">
    <header>
        <div class="inner d-flex main-axis-space-between cross-axis-center">
            <div class="header-left ">
                <a href="#" class="logo d-flex cross-axis-center">
                    <svg height="40px" fill="#343434" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28.46 28.46">
                        <g id="layer_2" data-name="layer 2">
                            <g id="layer_1-2" data-name="layer 1">
                                <rect x="0.5" y="0.5" width="27.46" height="27.46" rx="12"
                                      style="fill:none;stroke:#343434;stroke-miterlimit:10"/>
                                <rect x="2.23" y="2.23" width="24" height="24" rx="12"
                                      style="fill:none;stroke:#343434;stroke-miterlimit:10"/>
                                <path
                                    d="M8.54,17c0,.25.16.35.4.35h3.94a.42.42,0,0,1,.44.47.44.44,0,0,1-.44.49H8.63c-.79,0-1.13-.35-1.13-1.18V10.92c0-.84.34-1.18,1.13-1.18h4.15a.42.42,0,0,1,.44.47.43.43,0,0,1-.44.48H8.91c-.26,0-.37.12-.37.39v2.27h3.75a.43.43,0,0,1,.43.48.43.43,0,0,1-.43.46H8.54Z"/>
                                <path
                                    d="M15.08,18.06a.43.43,0,0,1-.43.31l-.22,0a.49.49,0,0,1-.38-.45.63.63,0,0,1,0-.19l3-7.51a.75.75,0,0,1,.76-.52.76.76,0,0,1,.78.52l3,7.53a.43.43,0,0,1,0,.19.49.49,0,0,1-.4.44.63.63,0,0,1-.19,0,.47.47,0,0,1-.46-.31l-.86-2.27H15.93Zm4.33-3.19-1.23-3.2c-.12-.32-.24-.67-.34-1a9.94,9.94,0,0,1-.34,1l-1.24,3.19Z"/>
                            </g>
                        </g>
                    </svg>
                    <div class="ml-10 ">Photo Store</div>
                </a>
            </div>

            <nav class="header-right d-flex">
                <a href="photo-upload.html" class="nav-item" @click.prevent="$router.push('/upload')"
                   v-if="isLogin == 1">Photo Upload</a>
                <a href="orders.html" class="nav-item" @click.prevent="$router.push('/orders')" v-if="isLogin == 1">Orders</a>
                <a href="cart.html" class="nav-item" @click.prevent="$router.push('/cart')" v-if="isLogin == 1">Cart</a>
                <a href="user-center.html" class="nav-item" @click.prevent="$router.push('/user')" v-if="isLogin == 1">User
                    Center</a>
                <a class="nav-item" href="login.html" @click.prevent="$router.push('/login')"
                   v-if="isLogin == 0">Login</a>
                <a class="nav-item" href="register.html" @click.prevent="logout" v-if="isLogin == 1">Logout</a>
            </nav>
        </div>
    </header>

    <tempalte v-if="$route.path == '/login'">
        <div class="inner layout-container" key="1818">
            <main class="main-content">
                <form action="" class="auth-form" ref="loginForm">
                    <div class="auth-title">Login</div>
                    <div class="form-combination ">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" v-model="loginForm.email" class="form-element">
                    </div>
                    <div class="form-combination mt-30">
                        <label for="password">Password</label>
                        <input type="password" id="password" v-model="loginForm.password" name="password"
                               class="form-element">
                    </div>

                    <button class="btn btn-blue mt-40 auth-btn" @click.prevent="loginHandle">Login</button>
                    <div class="text-right auth-tip">
                        <a href="register.html" @click.prevent="$router.push('/create')">create an account</a>
                    </div>
                </form>
            </main>
        </div>
    </tempalte>

    <template v-if="$route.path == '/create'">
        <div class="inner layout-container" key="2828">
            <main class="main-content">
                <form action="" class="auth-form" ref="regForm">
                    <div class="auth-title">Register</div>
                    <div class="form-combination ">
                        <label for="email1">Email</label>
                        <input type="email" id="email1" name="email" v-model="regForm.email" class="form-element">
                    </div>
                    <div class="form-combination mt-30">
                        <label for="username">Username</label>
                        <input type="text" id="username" name="username" v-model="regForm.username"
                               class="form-element">
                    </div>
                    <div class="form-combination mt-30">
                        <label for="password1">Password</label>
                        <input type="password" id="password1" name="password" v-model="regForm.password"
                               class="form-element">
                    </div>
                    <div class="form-combination mt-30">
                        <label for="repeat-password">Repeat Password</label>
                        <input type="password" id="repeat-password" name="repeat_password"
                               v-model="regForm.repeat_password" class="form-element">
                    </div>

                    <button class="btn btn-blue mt-40 auth-btn" @click.prevent="regHandle">Register</button>
                    <div class="text-right auth-tip">
                        <a href="login.html" @click.prevent="$router.push('/login')">I have an account</a>
                    </div>
                </form>
            </main>
        </div>
    </template>

    <template v-if="$route.path == '/home'">
        <div class="index-inner d-flex flex-col cross-axis-center">
            <img class="" src="imgs/title-2x.png" width="500px" alt="">
            <button class="btn btn-lg mt-60" @click.prevent="$router.push('/size')">GET IT NOW</button>
        </div>
    </template>

    <template v-if="$route.path == '/size'">
        <div class="inner layout-container" key="3838">

            <main class="main-content">
                <h1 class="main-title">Select Your Photo Size</h1>
                <div class="size-list mt-40">
                    <div class="size-item" v-for="(item,index) in sizeList" @click="sizeActiveIndex=index">
                        <span class="size-item-val">{{item.size.split(" ")[0]}}</span>
                        <span class="size-item-unit">Inch</span>
                    </div>

                </div>

                <div class="size-preview-container d-flex main-axis-center cross-axis-center mt-30">
                    <div class="size-preview-item"
                         :class="[sizeActiveIndex == index ? 'spv-active':'',sizeArr[sizeActiveIndex]]"
                         v-for="(item,index) in sizeList">
                        <div class="spv-width">{{item.width}}cm</div>
                        <div class="spv-height">{{item.height}}cm</div>
                        <div class="spv-size">{{item.size}}</div>
                        <div class="spv-oth">
                            <div class="spv-price">${{item.price.toFixed(2)}}</div>
                        </div>
                    </div>
                </div>

                <div class="function-btn-list d-flex main-axis-space-between">
                    <button class="btn btn-sm" disabled>Prev</button>
                    <button class="btn btn-sm btn-blue"
                            @click="$router.push({path:'/upload',query:{selectSize:sizeList[sizeActiveIndex].size,selectSizeId:sizeList[sizeActiveIndex].id}});">
                        Next
                    </button>
                </div>
            </main>
        </div>
    </template>

    <template v-if="$route.path == '/upload'">
        <div class="inner layout-container" key="4848">

            <main class="main-content">
                <h1 class="main-title">Upload Your Photo File -{{$route.query.selectSize}}</h1>

                <div class="upload-photo-list mt-40">
                    <label class="upload-tool">
                        <input type="file" multiple style="position: absolute;width: 0px;height: 0px;"
                               @change="photoChange">
                        <svg viewBox="0 0 1024 1024" version="1.1"
                             xmlns="http://www.w3.org/2000/svg" p-id="2739">
                            <path
                                d="M896 917.333333H128c-12.8 0-21.333333-8.533333-21.333333-21.333333V512c0-12.8 8.533333-21.333333 21.333333-21.333333s21.333333 8.533333 21.333333 21.333333v362.666667h725.333334V512c0-12.8 8.533333-21.333333 21.333333-21.333333s21.333333 8.533333 21.333333 21.333333v384c0 12.8-8.533333 21.333333-21.333333 21.333333zM704 341.333333c-6.4 0-10.666667-2.133333-14.933333-6.4L512 157.866667l-177.066667 177.066666c-8.533333 8.533333-21.333333 8.533333-29.866666 0s-8.533333-21.333333 0-29.866666l192-192c8.533333-8.533333 21.333333-8.533333 29.866666 0l192 192c8.533333 8.533333 8.533333 21.333333 0 29.866666-4.266667 4.266667-8.533333 6.4-14.933333 6.4z"
                                p-id="2740"></path>
                            <path
                                d="M512 704c-12.8 0-21.333333-8.533333-21.333333-21.333333V128c0-12.8 8.533333-21.333333 21.333333-21.333333s21.333333 8.533333 21.333333 21.333333v554.666667c0 12.8-8.533333 21.333333-21.333333 21.333333z"
                                p-id="2741">
                            </path>
                        </svg>
                    </label>

                    <div class="upload-photo-item" :style="{border:selectPhoto.includes(item)?'5px solid #3b82f6':''}"
                         v-for="item in photoList" @click="selectPhotoPushHandle(item)">
                        <div class="upi-mask">

                            <button class="upi-btn" @click.stop="editPhotoHandle(item)">
                                <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M0 298.666667h128v-85.333334H0v85.333334z m725.333333 725.333333V298.666667H384v-85.333334h426.666667v810.666667h-85.333334z m298.666667-298.666667v85.333334h-128v-85.333334h128zM298.666667 0v725.333333h341.333333v85.333334H213.333333V0h85.333334z"></path>
                                </svg>
                            </button>
                            <button class="upi-btn" @click.stop="setFrameHandle(item)">
                                <svg viewBox="0 0 1252 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M995.555556 256m-85.333333 0a1.5 1.5 0 1 0 170.666667 0 1.5 1.5 0 1 0-170.666667 0Z"
                                        p-id="11777"></path>
                                    <path
                                        d="M1243.591111 1024C1247.971556 1024 1251.555556 1020.302222 1251.555556 1015.751111L1251.555556 8.248889C1251.555556 3.697778 1247.971556 0 1243.591111 0L8.021333 0C3.584 0 0 3.697778 0 8.248889l0 1007.502222C0 1020.302222 3.584 1024 8.021333 1024L1243.591111 1024zM56.888889 56.888889l1137.777778 0 0 910.222222L56.888889 967.111111 56.888889 56.888889z"
                                        p-id="11778"></path>
                                    <path
                                        d="M848.156444 441.742222c-4.892444-7.68-14.734222-9.500444-22.072889-4.323556l-157.184 110.535111c-3.640889 2.56-8.590222 1.536-10.865778-2.389333L472.803556 225.621333C468.366222 217.884444 461.255111 217.827556 457.102222 225.792l-18.318222 35.271111L113.664 888.035556c-4.152889 8.021333-0.341333 14.449778 8.476444 14.449778l1004.430222 0c8.533333 0 12.003556-6.144 7.168-13.710222L848.156444 441.742222z"
                                        p-id="11779"></path>
                                </svg>
                            </button>
                            <button class="upi-btn" @click.stop="deletePhotoById(item.id)">
                                <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M938.666667 128h-42.666667v874.666667a21.333333 21.333333 0 0 1-21.333333 21.333333H149.333333a21.333333 21.333333 0 0 1-21.333333-21.333333V128H85.333333a21.333333 21.333333 0 0 1 0-42.666667h853.333334a21.333333 21.333333 0 0 1 0 42.666667z m-85.333334 0H170.666667v853.333333h682.666666V128z m-533.333333 85.333333a21.333333 21.333333 0 0 1 21.333333 21.333334v640a21.333333 21.333333 0 0 1-42.666666 0V234.666667a21.333333 21.333333 0 0 1 21.333333-21.333334z m192 0a21.333333 21.333333 0 0 1 21.333333 21.333334v640a21.333333 21.333333 0 0 1-42.666666 0V234.666667a21.333333 21.333333 0 0 1 21.333333-21.333334z m192 0a21.333333 21.333333 0 0 1 21.333333 21.333334v640a21.333333 21.333333 0 0 1-42.666666 0V234.666667a21.333333 21.333333 0 0 1 21.333333-21.333334z m0-170.666666H320a21.333333 21.333333 0 0 1 0-42.666667h384a21.333333 21.333333 0 0 1 0 42.666667z"></path>
                                </svg>
                            </button>
                        </div>

                        <img :src="item.original_url" alt="Image">
                    </div>
                </div>

                <div class="mt-40 function-btn-list d-flex main-axis-space-between">
                    <button class="btn btn-sm btn-red" @click="$router.push('/size')">Change Size</button>
                    <div>
                        <button class="btn btn-sm btn-blue" @click="addCart">Add to Cart</button>
                    </div>
                </div>
            </main>
        </div>

    </template>

    <template v-if="$route.path == '/process'">
        <div class="inner layout-container" key="5858">

            <main class="main-content">
                <h1 class="main-title process-title d-flex main-axis-space-between">
                    <div>Process Your Photo</div>
                </h1>

                <div class="photo-process-area d-flex main-axis-center cross-axis-center mt-40">
                    <div class="photo-container" style="position: relative">
                        <canvas width="1000" height="500" ref="editCanvas"></canvas>
                    </div>
                </div>

                <div class="mt-40 function-btn-list d-flex main-axis-space-between">
                    <button class="btn btn-sm btn-red" @click="$router.go(-1)">Cancel</button>
                    <div>
                        <button class="btn btn-sm btn-blue" @click="editPhotoFinishHandle">Finish</button>
                    </div>
                </div>
            </main>
        </div>

    </template>

    <template v-if="$route.path == '/frame'">

        <div class="inner layout-container" key="6868">
            <div class="frame-list">
                <div class="frame-item" v-for="item in frameList" @click="drawFrame(item)">
                    <div class="frame-thumbnail">
                        <img :src="item.url" alt="">
                    </div>
                    <div class="frame-info">
                        <div class="frame-name">{{item.name}}</div>
                        <div class="frame-info-inline d-flex main-axis-space-between">
                            <div class="frame-available">{{item.size}}</div>
                            <div class="frame-price">${{item.price.toFixed(2)}}</div>
                        </div>
                    </div>
                </div>
            </div>
            <main class="main-content">
                <h1 class="main-title">Choose Your Photo Frame</h1>

                <div class="frame-preview-area d-flex main-axis-center cross-axis-center mt-40">
                    <div class="frame-preview-container">
                        <!--                        <img src="imgs/mockup_1.jpg" style="width: 100%;" alt="">-->
                        <canvas width="1120px" height="600px" ref="frameCanvas"></canvas>
                    </div>
                </div>

                <div class="mt-40 function-btn-list d-flex main-axis-space-between">
                    <button class="btn btn-sm btn-red" @click="$router.go(-1)">Cancel</button>
                    <div>
                        <button class="btn btn-sm btn-blue" @click="frameFinishHandle">Finish</button>
                    </div>
                </div>
            </main>
        </div>

    </template>

    <template v-if="$route.path == '/cart'">
        <div class="inner layout-container" key="8888">
            <main class="main-content">
                <h1 class="main-title">Cart</h1>

                <table class="table">
                    <colgroup>
                        <col style="width: 30px;">
                        <col style="width: 150px;">
                        <col>
                        <col>
                        <col style="width: 160px">
                        <col style="width: 160px">
                        <col style="width: 100px;">
                    </colgroup>
                    <thead>
                    <tr>
                        <th></th>
                        <th class="text-left">Thumbnail</th>
                        <th class="text-left">Frame Name</th>
                        <th class="text-left">Size</th>
                        <th class="text-right">Print Price</th>
                        <th class="text-right">Frame Price</th>
                        <th class="text-left pl-30">Operation</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-for="item in cartList">
                        <td>
                            <input type="checkbox" v-model="item.selected">
                        </td>
                        <td>
                            <div class="photo-thumbnail">
                                <img :src="item.framed_url || item.original_url" alt="Image">
                            </div>
                        </td>
                        <td>
                            {{item.frame_name}}
                        </td>
                        <td>
                            {{item.size}}
                        </td>
                        <td class="text-right">${{item.print_price.toFixed(2)}}</td>
                        <td class="text-right">${{item.frame_price.toFixed(2)}}</td>
                        <td>
                            <div class="table-ope">
                                <button class="btn btn-sm btn-blue" @click="openModal();cartDesc = item;">Edit
                                </button>
                                <button class="btn btn-sm btn-red" @click="deletePhotoById(item.id)">Delete</button>
                            </div>

                        </td>
                    </tr>
                    </tbody>
                </table>

                <div class="mt-60"></div>
                <div class="cart-footer">
                    <div class="inner d-flex main-axis-space-between cross-axis-center">
                        <div>
                        </div>
                        <div class="cart-footer-info d-flex cross-axis-center">
                            <div class="cart-total">
                                Total: ${{getCartTotal}}({{cartList.filter(item => item.selected).length}} Photos)
                            </div>
                            <button class="cart-btn" @click.prevent="checkOutHandle">Checkout</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <div class="modal toast-modal edit-modal">
            <div class="modal-body ">
                <div>What do you want to do？</div>
                <div>
                    <a href="photo-processing.html" @click.prevent="editPhotoHandle(cartDesc)">1. Process Photo</a>
                </div>
                <div>
                    <a href="frame-choosing.html" @click.prevent="setFrameHandle(cartDesc)">2. Change Frame</a>
                </div>
                <div>
                    <a href="#" @click.prevent="closeModal()">3. Cancel</a>
                </div>
            </div>
        </div>

    </template>

    <template v-if="$route.path == '/checkOut'">
        <div class="inner layout-container" key="9898">
            <main class="main-content">
                <h1 class="main-title">Checkout</h1>

                <div class="mt-40 bg-white form-title">Complete Your Personal Information</div>
                <div class="content-group d-flex person-info-form">
                    <div class="form-combination">
                        <label for="full-name">Full Name</label>
                        <input type="text" class="form-element" id="full-name" v-model="submitOrderForm.full_name" name="full_name">
                    </div>
                    <div class="form-combination ml-30">
                        <label for="phone">Phone Number</label>
                        <input type="text" class="form-element" id="phone" v-model="submitOrderForm.phone_number" name="phone_number">
                    </div>

                    <div class="form-combination ml-30">
                        <label for="address">Shipping address</label>
                        <input type="text" class="form-element" id="address" v-model="submitOrderForm.shipping_address" name="shipping_address">
                    </div>
                </div>

                <div class="mt-40 bg-white form-title">Complete Your Credit Card Information</div>
                <div class="content-group d-flex credit-info-form">
                    <div class="form-combination w-30">
                        <label for="card-number">Card Number</label>
                        <input type="text" class="form-element" id="card-number"  v-model="submitOrderForm.card_number" name="card_number">
                    </div>

                    <div class="form-combination ml-30 w-30">
                        <label for="name-on-card">Name on Card</label>
                        <input type="text" class="form-element" id="name-on-card"  v-model="submitOrderForm.name_on_card" name="name_on_card">
                    </div>

                    <div class="form-combination ml-30">
                        <label for="exp-date">Expiration date</label>
                        <input type="date" class="form-element" id="exp-date" v-model="submitOrderForm.exp_date" name="exp_date">
                    </div>

                    <div class="form-combination ml-30 w-15">
                        <label for="cvv">CVV/CID</label>
                        <input type="text" class="form-element" id="cvv" v-model="submitOrderForm.cvv" name="cvv">
                    </div>
                </div>

                <div class="mt-40 bg-white form-title">Photo List</div>
                <div class="content-group checkout-photo-list">
                    <table class="table">
                        <colgroup>
                            <col style="width: 150px;">
                            <col>
                            <col >
                            <col style="width: 160px">
                            <col style="width: 160px">
                        </colgroup>
                        <thead>
                        <tr>
                            <th class="text-left">Thumbnail</th>
                            <th class="text-left">Frame Name</th>
                            <th class="text-left">Size</th>
                            <th class="text-right">Print Price</th>
                            <th class="text-right">Frame Price</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr v-for="item in checkOutPhotoList">

                            <td>
                                <div class="photo-thumbnail">
                                    <img :src="item.framed_url || item.original_url" alt="Image">
                                </div>
                            </td>
                            <td>
                                {{item.frame_name}}
                            </td>
                            <td>
                                {{item.size}}
                            </td>
                            <td class="text-right">${{item.print_price.toFixed(2)}}</td>
                            <td class="text-right">${{item.frame_price.toFixed(2)}}</td>

                        </tr>
                        </tbody>
                    </table>

                </div>

                <div class="mt-60"></div>

                <div class="cart-footer">
                    <div class="inner d-flex main-axis-space-between cross-axis-center">
                        <div>
                            <button class="checkout-cancel-btn" @click="$router.go(-1)">Cancel</button>
                        </div>
                        <div class="cart-footer-info d-flex cross-axis-center">
                            <div class="cart-total">
                                Total: ${{getCheckoutTotal}}
                            </div>
                            <button class="checkout-submit-btn" @click="creteOrder">Submit</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </template>

    <template v-if="$route.path == '/orders'">
            <div class="inner layout-container" key="7878">
                <main class="main-content">
                    <h1 class="main-title">My Orders</h1>
                    <table class="table">
                        <colgroup>
                            <col style="width: 100px;">
                            <col>
                            <col style="width: 200px;">
                            <col style="width: 100px">
                            <col style="width: 120px">
                            <col style="width: 130px">
                        </colgroup>
                        <thead>
                        <tr>
                            <th class="text-left">No.</th>
                            <th class="text-left">Thumbnail</th>
                            <th class="text-left">Order Placed</th>
                            <th>Status</th>
                            <th class="text-right">Total</th>
                            <th class="text-left pl-30">Operation</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr v-for="item in orderList">
                            <td>{{item.id+10000000}}</td>
                            <td>
                                <div class="order-thumbnail-list" data-num="5">
                                    <div class="photo-thumbnail"  v-for="child in item.photos.slice(0,5)">
                                        <img :src="child.framed_url || child.original_url" alt="">
                                    </div>
                                </div>

                            </td>
                            <td>
                                {{item.order_placed}}
                            </td>
                            <td class="text-center">
                                {{item.status}}
                            </td>

                            <td class="text-right">
                                ${{item.total.toFixed(2)}}
                            </td>
                            <td>
                                <div class="table-ope">
                                    <button class="btn btn-sm btn-blue" @click="getOrderDetails(item)">View More</button>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </main>
            </div>

            <div class="modal" id="orderDetails">
                <div class="modal-body">
                    <div class="modal-title">More Information</div>
                    <table class="table-bordered mt-30">
                        <colgroup>
                            <col style="width: 200px;">
                            <col>
                            <col style="width: 160px;">
                            <col>
                        </colgroup>
                        <tbody>
                        <tr>
                            <td>Full Name</td>
                            <td>{{orderDetails.full_name}}</td>
                            <td>Phone Number</td>
                            <td>{{orderDetails.phone_number}}</td>
                        </tr>
                        <tr>
                            <td>Shipping Address</td>
                            <td colspan="3">{{orderDetails.shipping_address}}</td>
                        </tr>
                        </tbody>
                    </table>

                    <div class="mt-30 bg-white form-title">Order List</div>

                    <div class=" content-group">
                        <div class="order-list-table-container">
                            <table class="table" style="margin-top: -10px">
                                <colgroup>
                                    <col style="width: 150px;">
                                    <col style="width: 200px">
                                    <col >
                                    <col style="width: 100px">
                                    <col style="width: 100px">
                                </colgroup>
                                <thead>
                                <tr>
                                    <th class="text-left">Thumbnail</th>
                                    <th class="text-left">Frame Name</th>
                                    <th class="text-center">Size</th>
                                    <th class="text-right">Print Price</th>
                                    <th class="text-right">Frame Price</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="item in orderDetails.photos">

                                    <td>
                                        <div class="photo-thumbnail">
                                            <img :src="item.original_url" alt="Image">
                                        </div>
                                    </td>
                                    <td>
                                        {{item.frame_name}}
                                    </td>
                                    <td class="text-center">
                                        {{item.size}}
                                    </td>
                                    <td class="text-right">${{item.print_price.toFixed(2)}}</td>
                                    <td class="text-right">${{item.frame_price.toFixed(2)}}</td>

                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="d-flex main-axis-space-between">
                        <div></div>
                        <div>
                            <button class="mt-30 btn btn-blue btn-sm" onclick="closeModal()">Hide</button>
                        </div>
                    </div>
                </div>
            </div>
    </template>

    <template v-if="$route.path == '/user'">
        <div class="inner layout-container" key="0808">
            <main class="main-content">
                <h1 class="main-title">User Center</h1>
                <div class="mt-40">
                    <div class="info-combination ">
                        <div class="info-title">Username</div>
                        <div class="info-content">{{userInfo.username}}</div>
                    </div>

                    <div class="info-combination ">
                        <div class="info-title">Email</div>
                        <div class="info-content">{{userInfo.email}}</div>
                    </div>

                    <div class="info-combination ">
                        <div class="info-title">Create Time</div>
                        <div class="info-content">{{userInfo.create_time}}</div>
                    </div>

                    <div class="info-combination ">
                        <div class="info-title">Password</div>
                        <div class="info-content">*****************</div>
                    </div>

                    <div class="info-combination ">
                        <div class="info-title">Operation</div>
                        <div class="info-content">
                            <button class="btn btn-sm btn-green" @click="$router.push('/orders')">My Orders</button>
                            <button class="btn btn-sm btn-red ml-20" onclick="openModal()">Reset Password</button>
                        </div>
                    </div>
                </div>

            </main>
        </div>
        <div class="modal toast-modal">
            <div class="modal-body">
                <form action="" class="auth-form">
                    <div class="auth-title">Reset Password</div>
                    <div class="form-combination ">
                        <label for="original-password">Original Password</label>
                        <input type="password" id="original-password" name="original_password" v-model="resetForm.original_password" class="form-element">
                    </div>

                    <div class="form-combination mt-20">
                        <label for="new-password">New Password</label>
                        <input type="password" id="new-password" name="new_password" v-model="resetForm.new_password"  class="form-element">
                    </div>

                    <div class="form-combination mt-20">
                        <label for="repeat-password1">Repeat Password</label>
                        <input type="password" id="repeat-password1" name="repeat_password" v-model="resetForm.repeat_password"  class="form-element">
                    </div>

                    <button class="btn btn-blue mt-30 auth-btn" @click.prevent="resetUserPassword">Reset</button>
                    <div class="text-right auth-tip">
                        <a href="#" onclick="closeModal()">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </template>
</div>
<script>

    const request = axios.create({
        baseURL: "http://127.0.0.1/ws02_ServerSide/api/v1"
    });

    request.interceptors.request.use(config => {
        config.url += `?token=${localStorage.getItem("token")}`
        return config;
    })

    request.interceptors.response.use(res => {
        return res.data;
    }, (e) => {
        if (e.response.status == 401) {
            if (localStorage.getItem("token")) app.logout();
            alert(e.response.data.msg)
        } else if (e.response.status == 404) {
            return [];
        } else {
            alert(e.response.data.msg)
        }
    })

    const router = new VueRouter({
        routes: [
            {
                path: "/",
                redirect: "/home"
            }
        ]
    })

    const app = new Vue({
        router,
        data: {
            loginForm: {
                email: "user@eaphoto.com",
                password: "user"
            },

            regForm: {
                email: "",
                username: "",
                password: "",
                repeat_password: ""
            },

            isLogin: null,

            sizeList: [],
            sizeActiveIndex: 0,
            sizeArr: ["one-inch", "two-inch", "three-inch", "five-inch", "six-inch", "seven-inch", "eight-inch"],

            selectPhoto: [],
            photoList: [],

            editCanvas: null, // 编辑canvas
            editPhotoFinishHandle: null, // 确认裁剪

            frameList: [],
            frameCanvas: null, // 设置相框canvas
            frame: {},

            cartList: [],
            cartDesc:{},

            submitOrderForm:{
                full_name:"",
                phone_number:"",
                shipping_address:"",
                card_number:"",
                name_on_card:"",
                exp_date:"",
                cvv:""
            },
            checkOutPhotoList:[],

            orderList:[],
            orderDetails:{},

            userInfo:{},
            resetForm:{
                original_password:"",
                new_password:"",
                repeat_password:""
            }
        },
        created() {
            this.init();
        },
        watch: {
            "$route.path"(val) {
                this.init();
            },
            "$route.query"(val) {
                this.init();
            },
        },
        computed:{
            getCartTotal(){
                let total = 0;
                this.cartList.filter(item=>{
                    if(item.selected) total+= item.print_price + item.frame_price;
                })
                return total.toFixed(2);
            },
            getCheckoutTotal(){
                let total = 0;
                this.checkOutPhotoList.filter(item=>{
                    total+= item.print_price + item.frame_price;
                })
                return total.toFixed(2);
            }
        },
        methods: {
            init() {
                this.isLogin = localStorage.getItem('token') ? 1 : 0;
                let path = this.$route.path;
                if (path == '/size') {
                    this.getSize();
                } else if (path == '/upload') {
                    this.getPhotos();
                } else if (path == '/process') {
                    this.$nextTick(() => {
                        this.editCanvas = this.$refs.editCanvas;
                        this.initEditCanvas();
                    });
                } else if (path == '/frame') {
                    this.getFrame();
                    this.$nextTick(() => {
                        this.frameCanvas = this.$refs.frameCanvas;
                        this.initFrameCanvas();
                    })
                } else if (path == '/cart') {
                    this.getCart();
                } else if(path == '/checkOut'){
                    let data = [];
                    if(this.$route.query.data){
                        data = JSON.parse(this.$route.query.data)
                    }
                    if(data.length == 0) this.$router.push('/cart');
                    this.checkOutPhotoList = data;
                }else if(path =='/orders'){
                    this.getOrders();
                }else if(path == '/user'){
                    this.userInfo = JSON.parse(localStorage.getItem('userInfo'));
                }
            },
            loginHandle() {
                request({
                    url: "/client/login",
                    method: "post",
                    data: this.loginForm
                }).then(res => {
                    if (res.msg == 'success') {
                        localStorage.setItem("token", res.data.token);
                        localStorage.setItem("userInfo", JSON.stringify(res.data));
                        this.$router.push('/home');
                    }
                })
            },
            regHandle() {
                request({
                    url: "/client/register",
                    method: "post",
                    data: this.regForm
                }).then(res => {
                    if (res.msg == 'success') {
                        this.loginForm = {...this.regForm};
                        this.loginHandle()
                        Object.assign(this.regForm,
                            {
                                email: "",
                                username: "",
                                password: "",
                                repeat_password: ""
                            }
                        );
                    }
                })
            },

            getSize() {
                request({
                    url: "/client/size",
                    method: 'get',
                }).then(res => {
                    this.sizeList = res.data;
                })
            },

            getPhotos() {
                if (!this.$route.query.selectSizeId) return this.$router.push('/size')
                request({
                    url: "/client/photo/size/" + this.$route.query.selectSizeId,
                    method: "get",
                }).then(res => {
                    this.photoList = res.data;
                })
            },

            selectPhotoPushHandle(it) {
                let index = this.selectPhoto.findIndex(item => item.id == it.id);
                if (index == -1) {
                    this.selectPhoto.push(it);
                } else {
                    this.selectPhoto.splice(index, 1);
                }
            },

            addCart() {
                let ids = this.selectPhoto.map(item => item.id);
                if (!ids.length) return;
                request({
                    url: "/client/cart",
                    method: "post",
                    data: {photo_id_list: ids}
                }).then(res => {
                    this.getPhotos();
                    this.$router.push('/cart');
                });
            },


            photoChange(event) {
                let file = event.target.files;
                let fileData = new FormData();
                fileData.append("image", file[0]);
                fileData.append("size_id", this.$route.query.selectSizeId);
                request({
                    url: "/client/photo",
                    method: 'post',
                    data: fileData
                }).then(res => {
                    console.log(res)
                    this.getPhotos();
                })
            },
            deletePhotoById(id) {
                request({
                    url: "/client/photo/" + id,
                    method: 'delete',
                }).then(res => {
                    console.log(res)
                    if(this.$route.path == '/cart'){
                        this.getCart();
                    }else{
                        this.getPhotos();
                    }
                })
            },
            editPhotoHandle(item) {
                this.$router.push({
                    path: "/process",
                    query: {url: item.original_url, photoId: item.id, ...this.$route.query}
                });
                this.$nextTick(() => {
                    this.editCanvas = this.$refs.editCanvas;
                    this.initEditCanvas();
                });
            },
            initEditCanvas() {
                if (!this.$route.query.url || !this.$route.query.photoId) return this.$router.push('/upload');
                let canvas = this.editCanvas;
                let ctx = canvas.getContext('2d')
                let img = new Image();
                // 定义框的位置
                let box = {x: canvas.width / 2 - 150, y: canvas.height / 2 - 100, width: 300, height: 200}

                img.src = this.$route.query.url;
                let index = null;
                img.onload = function () {
                    draw();
                }


                canvas.addEventListener("mousedown", function (e) {
                    let mouseX = e.offsetX;
                    let mouseY = e.offsetY;
                    if (mouseX >= box.x && mouseX <= box.x + 10 && mouseY >= box.y && mouseY <= box.y + 10) {
                        index = 1;
                        canvas.addEventListener('mousemove', changeBox, false);
                        canvas.addEventListener('mouseup', function () {
                            canvas.removeEventListener('mousemove', changeBox, false);
                        }, false);
                    } else if (mouseX >= box.x && mouseX <= box.x + 10 && mouseY >= box.y + box.height - 10 && mouseY <= box.y + box.height) {
                        index = 2;
                        canvas.addEventListener('mousemove', changeBox, false);
                        canvas.addEventListener('mouseup', function () {
                            canvas.removeEventListener('mousemove', changeBox, false);
                        }, false);
                    } else if (mouseX >= box.x + box.width - 10 && mouseX <= box.x + box.width && mouseY >= box.y && mouseY <= box.y + 10) {
                        index = 3;
                        canvas.addEventListener('mousemove', changeBox, false);
                        canvas.addEventListener('mouseup', function () {
                            canvas.removeEventListener('mousemove', changeBox, false);
                        }, false);
                    } else if (mouseX >= box.x + box.width - 10 && mouseX <= box.x + box.width && mouseY >= box.y + box.height - 10 && mouseY <= box.y + box.height) {
                        index = 4;
                        canvas.addEventListener('mousemove', changeBox, false);
                        canvas.addEventListener('mouseup', function () {
                            canvas.removeEventListener('mousemove', changeBox, false);
                        }, false);
                    } else if (mouseX >= box.x && mouseX <= mouseX + box.width && mouseY >= box.y && mouseY <= box.y + box.height) {
                        index = 5;
                        canvas.addEventListener('mousemove', changeBox, false);
                        canvas.addEventListener('mouseup', function () {
                            canvas.removeEventListener('mousemove', changeBox, false);
                        }, false);
                    }
                }, false)

                function changeBox(e) {
                    // if (box.width <= 150 && box.height <= 150) {
                    //     box.width = 152;
                    //     box.height = 152;
                    //     draw();
                    //     return;
                    // }
                    if (index == 1) {// 左上
                        box.width += box.x - e.offsetX;
                        box.height += box.y - e.offsetY;
                        box.x = e.offsetX;
                        box.y = e.offsetY;
                    }

                    if (index == 2) {// 左下
                        box.width += box.x - e.offsetX;
                        box.height = e.offsetY - box.y;
                        box.x = e.offsetX;
                    }
                    if (index == 3) {// 右上
                        box.width = e.offsetX - box.x;
                        box.height += box.y - e.offsetY;
                        box.y = e.offsetY;
                    }

                    if (index == 4) {// 右下
                        box.width = e.offsetX - box.x;
                        box.height = e.offsetY - box.y;
                    }

                    if (index == 5) { //移动
                        box.x = e.offsetX - box.x / 2;
                        box.y = e.offsetY - box.y / 2;
                    }
                    draw();
                }


                function draw() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                    ctx.strokeStyle = 'green';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(box.x, box.y, box.width, box.height);

                    // 左上
                    ctx.fillStyle = '#FFF';
                    ctx.fillRect(box.x, box.y, 10, 10);
                    ctx.strokeStyle = 'black';
                    ctx.strokeRect(box.x, box.y, 10, 10);

                    // 左下
                    ctx.fillStyle = '#FFF';
                    ctx.fillRect(box.x, box.y + box.height - 10, 10, 10);
                    ctx.strokeStyle = 'black';
                    ctx.strokeRect(box.x, box.y + box.height - 10, 10, 10);

                    // 右上
                    ctx.fillStyle = '#FFF';
                    ctx.fillRect(box.x + box.width - 10, box.y, 10, 10);
                    ctx.strokeStyle = 'black';
                    ctx.strokeRect(box.x + box.width - 10, box.y, 10, 10);

                    // 右下
                    ctx.fillStyle = '#FFF';
                    ctx.fillRect(box.x + box.width - 10, box.y + box.height - 10, 10, 10);
                    ctx.strokeStyle = 'black';
                    ctx.strokeRect(box.x + box.width - 10, box.y + box.height - 10, 10, 10);
                }

                let _this = this;
                this.editPhotoFinishHandle = function () {
                    let tmpCanvas = document.createElement("canvas");
                    tmpCanvas.width = box.width;
                    tmpCanvas.height = box.height;
                    let ctx = tmpCanvas.getContext("2d");
                    ctx.drawImage(img, -box.x, -box.y, canvas.width, canvas.height);

                    tmpCanvas.toBlob((blob) => {
                        let fileData = new FormData();
                        fileData.append("image", blob);
                        request({
                            url: "/client/editPhoto/" + _this.$route.query.photoId,
                            method: "post",
                            data: fileData
                        }).then(res => {
                            _this.$router.go(-1);
                        })
                    });


                }
            },

            setFrameHandle(item) {
                console.log({...this.$route.query, url: item.original_url, photoId: item.id, framedUrl: item.framed_url,size:item.size})
                this.$router.push({
                    path: '/frame',
                    query: {...this.$route.query, url: item.original_url, photoId: item.id, framedUrl: item.framed_url,size:item.size}
                })
            },

            getFrame() {
                request({
                    url: "/client/frame",
                    method: "get",
                }).then(res => {
                    this.frameList = res.data;
                })
            },

            initFrameCanvas() {
                if (!this.$route.query.url || !this.$route.query.photoId || (!this.$route.query.selectSize && !this.$route.query.size)) return this.$router.push('/upload');
                let canvas = this.frameCanvas;
                let ctx = canvas.getContext('2d');
                let img = new Image();
                img.src = this.$route.query.url;
                img.onload = function () {
                    draw();
                }

                function draw() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                }
            },

            frameFinishHandle() {
                let photoId = this.$route.query.photoId;
                let frameId = this.frame?.id || 0;
                this.frameCanvas.toBlob(blob => {
                    let fileData = new FormData();
                    fileData.append("image", blob);
                    request({
                        url: `/client/photo/frame/${photoId}/${frameId}`,
                        method: "post",
                        data: fileData
                    }).then(res => {
                        this.$router.go(-1);
                    })
                })
            },

            drawFrame(item) {
                if (item.size !== this.$route.query.selectSize&&item.size !== this.$route.query.size) return alert("size not match");
                let canvas = this.frameCanvas;
                let ctx = canvas.getContext('2d');
                let _this = this;
                if (this.frame.id == item.id) {
                    this.frame = {};
                    let img = new Image();
                    img.src = _this.$route.query.url;
                    img.onload = function () {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    }
                } else {
                    let img = new Image();
                    img.src = item.url;
                    img.onload = function () {
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        let photo = new Image();
                        photo.src = _this.$route.query.url;
                        photo.onload = function () {
                            ctx.drawImage(photo, 295, 160, 530, 280);
                            _this.frame = item;
                        }
                    }

                }
            },

            getCart() {
                request({
                    url: "/client/cart",
                    method: "get",
                }).then(res => {
                    this.cartList = res.data.map(item=>{
                        return{
                            ...item,
                            selected:false
                        }
                    });
                })
            },

            checkOutHandle(){
                if(this.cartList.filter(item=>item.selected).length ==0) return;
                this.$router.push({path:"/checkOut",query:{data:JSON.stringify(this.cartList.filter(item=>item.selected))}})
            },

            creteOrder(){
                request({
                    url:"/client/order",
                    method:"post",
                    data:{
                        ...this.submitOrderForm,
                        photo_id_list: this.checkOutPhotoList.map(item=>item.id),
                    }
                }).then(res=>{
                    this.$router.push('/orders');
                    Object.assign(this.submitOrderForm,{
                        full_name:"",
                        phone_number:"",
                        shipping_address:"",
                        card_number:"",
                        name_on_card:"",
                        exp_date:"",
                        cvv:""
                    });
                });
            },

            getOrders(){
                request({
                    url:"/client/order",
                    method:"get",
                }).then(res=>{
                    this.orderList = res.data;
                })
            },

            getOrderDetails(item){
                this.orderDetails = item;
                openModal("#orderDetails")
            },

            logout() {
                request({
                    url: "/client/logout",
                    method: "post",
                }).then(res => {
                    this.$router.push('/login')
                    localStorage.clear();
                    sessionStorage.clear();
                })
            },
            resetUserPassword(){
                request({
                    url:"/client/user/reset",
                    method:"post",
                    data:this.resetForm
                }).then(res=>{
                    closeModal();
                    Object.assign(this.resetForm,{
                        original_password:"",
                        new_password:"",
                        repeat_password:""
                    })
                })
            },
        },
    }).$mount("#app")

    function openModal() {
        document.querySelector(".modal").style.display = "flex";
    }

    function closeModal(){
        document.querySelector(".modal").style.display = "none";
    }
</script>
</body>
</html>
